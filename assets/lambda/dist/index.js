"use strict";var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var l=(o,e)=>{for(var r in e)i(o,r,{get:e[r],enumerable:!0})},p=(o,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of u(e))!g.call(o,s)&&s!==r&&i(o,s,{get:()=>e[s],enumerable:!(n=d(e,s))||n.enumerable});return o};var m=o=>p(i({},"__esModule",{value:!0}),o);var R={};l(R,{handler:()=>f});module.exports=m(R);var a=require("child_process"),f=async function(o){let e=o.RequestType,r=o.ResourceProperties;if(!r.addr||!r.imageUri)throw new Error("addr and imageUri are required.");let n={PhysicalResourceId:r.addr,Data:{}};if(e==="Create"||e==="Update"){let s=r.ignore.map(c=>`-i ${c}`).join(" "),t=(0,a.spawnSync)(`/opt/dockle --exit-code 1 --exit-level fatal --no-color ${s} ${r.imageUri}`,{shell:!0});if(console.log("imageUri: "+r.imageUri),console.log(`stdout:
`+t.stdout?.toString()),console.log(`stderr:
`+t.stderr?.toString()),t.status!==0)throw new Error("Image Scanner returned fatal errors. You may have vulnerabilities. See logs.")}return n};0&&(module.exports={handler});
